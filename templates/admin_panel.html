{% extends "base.html" %} {% block title %}Admin Panel | Selling-options.com{%
endblock %} {% block content %}
<div class="admin-container">
    <h1>Manage Users</h1>


    <div class="users-section">
        <h2>Recent Users</h2>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Email</th>
                    <th>Joined</th>
                    <th>Last Login</th>
                    <th>Logins</th>
                    <th>Status</th>
                    <th>Role</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in recent_users %}
                <tr>
                    <td>{{ user[0] }}</td>
                    <td>{{ user[1] }}</td>
                    <td>
                        {{ user[2].strftime('%Y-%m-%d') if user[2] else 'N/A' }}
                    </td>
                    <td>
                        {{ user[4].strftime('%Y-%m-%d %H:%M') if user[4] else
                        'Never' }}
                    </td>
                    <td>{{ user[5] or 0 }}</td>
                    <td>
                        <span
                            class="status-badge {{ 'active' if user[3] else 'inactive' }}"
                        >
                            {{ 'Active' if user[3] else 'Inactive' }}
                        </span>
                    </td>
                    <td>
                        <span
                            class="status-badge {{ 'admin-role' if user[7] else 'user-role' }}"
                        >
                            {{ user[6] }}
                        </span>
                    </td>
                    <td class="action-buttons">
                        <select class="action-dropdown" onchange="handleAction(this, {{ user[0] }}, '{{ user[3] }}', '{{ user[7] }}')">
                            <option value="">Select Action...</option>
                            <option value="toggle">{{ 'Deactivate' if user[3] else 'Activate' }}</option>
                            {% if user[7] %}
                            <option value="remove_admin">Remove Admin</option>
                            {% else %}
                            <option value="make_admin">Make Admin</option>
                            {% endif %}
                            <option value="reset_password">Reset Password</option>
                            <option value="delete">Delete User</option>
                        </select>
                        <form id="reset-form-{{ user[0] }}" method="POST" action="{{ url_for('admin.reset_password', user_id=user[0]) }}" style="display: none;"></form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="admin-actions">
        <a href="{{ url_for('main.index') }}" class="btn">Back</a>
    </div>
</div>
<style>
.action-dropdown {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    background: white;
    cursor: pointer;
    font-size: 14px;
    min-width: 150px;
}
.action-dropdown:hover {
    border-color: #4CAF50;
}
.action-dropdown:focus {
    outline: none;
    border-color: #4CAF50;
    box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
}
</style>

<script>
function handleAction(selectElement, userId, isActive, isAdmin) {
    var action = selectElement.value;
    if (!action) return;
    
    var confirmMsg = '';
    var url = '';
    
    switch(action) {
        case 'toggle':
            url = '/admin/toggle_user/' + userId;
            break;
        case 'make_admin':
            url = '/admin/make_admin/' + userId;
            break;
        case 'remove_admin':
            url = '/admin/remove_admin/' + userId;
            break;
        case 'reset_password':
            if (confirm('Are you sure you want to reset this user password? A new secure temporary password will be generated.')) {
                document.getElementById('reset-form-' + userId).submit();
            }
            selectElement.value = '';
            return;
        case 'delete':
            if (confirm('Are you sure you want to permanently delete this user?')) {
                window.location.href = '/admin/delete_user/' + userId;
            }
            selectElement.value = '';
            return;
    }
    
    if (url) {
        window.location.href = url;
    }
    selectElement.value = '';
}
</script>
{% endblock %}
